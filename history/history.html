<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700;800&display=swap">
</head>

<body style="font-family: 'Poppins', sans-serif;">

    <button type="button" class="btn btn-primary" id='btns' data-bs-toggle="modal"
        data-bs-target="#history_modal">Button</button>



    <div class="modal fade" id="history_modal" tabindex="-1" role="dialog" aria-labelledby="history_modal_title"
        aria-hidden="true">
        <div class="modal-dialog modal-fullscreen-md-down mt-md-5 modal-xl">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #E1B02E;">
                    <h1 class="modal-title fs-5 text-center" id="exampleModalLabel" style="color: #202020;">History</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body h-100 p-0">
                    <div class="accordion accordion-flush" id="accordionFlushExample"
                        style="border-top: 1px solid #202020;">
                        <!--Active Bookings-->
                        <div class="accordion-item" style=" border-bottom: 1px solid #202020;">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#flush-collapseOne" aria-expanded="true"
                                    aria-controls="flush-collapseOne"
                                    style="color: #202020; background-color: #E1B02E;">
                                    Active bookings
                                </button>
                            </h2>
                            <div id="flush-collapseOne" class="accordion-collapse collapse show mb-0"
                                data-bs-parent="#accordionFlushExample" style="max-height: 50vh; overflow-y: auto;">
                                <div class="accordion-body">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th class="col-1">#</th>
                                                <th class="col-3">Place</th>
                                                <th class="col-4">From</th>
                                                <th class="col-4">To</th>
                                            </tr>
                                        </thead>
                                        <tbody id="active-table-body">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!--Inactive Bookings-->
                        <div class="accordion-item" style=" border-bottom: 1px solid #202020;">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#flush-collapseTwo" aria-expanded="false"
                                    aria-controls="flush-collapseTwo"
                                    style="color: #202020; background-color: #E1B02E;">
                                    Inactive bookings
                                </button>
                            </h2>
                            <div id="flush-collapseTwo" class="accordion-collapse collapse"
                                data-bs-parent="#accordionFlushExample" style="max-height: 50vh; overflow-y: auto;">
                                <div class="accordion-body">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th class="col-1">#</th>
                                                <th class="col-3">Place</th>
                                                <th class="col-4">From</th>
                                                <th class="col-4">To</th>
                                            </tr>
                                        </thead>
                                        <tbody id="inactive-table-body">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        window.addEventListener("load", function () { document.getElementById('btns').click(); printActiveBookings(); printInactiveBookings(); })
    </script>

    <script>

        function printActiveBookings() {
            //При всяко викане на ф-цията, ще се тегли json таблицата
            let exampleActive = [
                {
                    "parkingSpaceId": "A1",
                    "duration": "04:00:00",
                    "startTime": "26/02/2024, 09:00"
                },
                {
                    "parkingSpaceId": "A2",
                    "duration": "08:00:00",
                    "startTime": "26/02/2024, 12:00"
                },
                {
                    "parkingSpaceId": "A4",
                    "duration": "07:00:00",
                    "startTime": "26/02/2024, 11:00"
                },
                {
                    "parkingSpaceId": "A3",
                    "duration": "04:00:00",
                    "startTime": "26/02/2024, 10:00"
                }
            ];
            exampleActive.sort(function (a, b) {
                var dateA = new Date(a.startTime.replace(/(\d{2})\/(\d{2})\/(\d{4}), (\d{2}):(\d{2})/, '$3-$2-$1T$4:$5'));
                var dateB = new Date(b.startTime.replace(/(\d{2})\/(\d{2})\/(\d{4}), (\d{2}):(\d{2})/, '$3-$2-$1T$4:$5'));

                return dateA - dateB;
            });

            console.log(exampleActive);
            let lengthActive = exampleActive.length;
            let active_table_body = document.getElementById('active-table-body');
            if (lengthActive == 0) {
                active_table_body.innerHTML = "<h2 class='d-flex justify-content-center w-100'>There are no active bookings.</h2>";
            }
            for (let i = 0; i < lengthActive; i++) {
                let tr = document.createElement('tr');
                let th = document.createElement('th');
                th.scope = 'row';
                th.innerHTML = (i + 1);
                tr.appendChild(th);

                let tdPlace = document.createElement('td'); let place = exampleActive[i].parkingSpaceId;
                let tdFrom = document.createElement('td'); let from = exampleActive[i].startTime;
                let duration = calculateDuration(exampleActive, i);
                let tdTo = document.createElement('td'); let to = exampleActive[i].startTime.slice(0, 12) + duration;
                tdPlace.innerHTML = place; tr.appendChild(tdPlace);
                tdFrom.innerHTML = from; tr.appendChild(tdFrom);
                tdTo.innerHTML = to; tr.appendChild(tdTo);

                active_table_body.appendChild(tr);
            }
        }

        function printInactiveBookings() {
            //При всяко викане на ф-цията, ще се тегли json таблицата
            let exampleInactive = [
                {
                    "parkingSpaceId": "A2",
                    "duration": "02:00:00",
                    "startTime": "24/02/2024, 11:00"
                },
                {
                    "parkingSpaceId": "A4",
                    "duration": "02:00:00",
                    "startTime": "20/02/2024, 11:00"
                },
                {
                    "parkingSpaceId": "A1",
                    "duration": "03:00:00",
                    "startTime": "26/02/2024, 07:00"
                },
                {
                    "parkingSpaceId": "A3",
                    "duration": "02:00:00",
                    "startTime": "23/02/2024, 11:00"
                }
            ];

            exampleInactive.sort(function (a, b) {
                var dateA = new Date(a.startTime.replace(/(\d{2})\/(\d{2})\/(\d{4}), (\d{2}):(\d{2})/, '$3-$2-$1T$4:$5'));
                var dateB = new Date(b.startTime.replace(/(\d{2})\/(\d{2})\/(\d{4}), (\d{2}):(\d{2})/, '$3-$2-$1T$4:$5'));

                return dateA - dateB;
            });

            let lengthInactive = exampleInactive.length;
            let inactive_table_body = document.getElementById('inactive-table-body');
            if (lengthInactive == 0) {
                inactive_table_body.innerHTML = "<h2 class='d-flex justify-content-center w-100'>There are no active bookings.</h2>";
            }
            for (let i = 0; i < lengthInactive; i++) {
                let tr = document.createElement('tr');
                let th = document.createElement('th');
                th.scope = 'row';
                th.innerHTML = (i + 1);
                tr.appendChild(th);

                let tdPlace = document.createElement('td'); let place = exampleInactive[i].parkingSpaceId;
                let tdFrom = document.createElement('td'); let from = exampleInactive[i].startTime;
                let duration = calculateDuration(exampleInactive, i);
                let tdTo = document.createElement('td'); let to = exampleInactive[i].startTime.slice(0, 12) + duration;
                tdPlace.innerHTML = place; tr.appendChild(tdPlace);
                tdFrom.innerHTML = from; tr.appendChild(tdFrom);
                tdTo.innerHTML = to; tr.appendChild(tdTo);

                inactive_table_body.appendChild(tr);
            }
        }


        function calculateDuration(tableRow, i) {
            let durationH = Number(tableRow[i].duration.slice(0, 2));
            let durationM = Number(tableRow[i].duration.slice(3, 5));
            durationH += Number(tableRow[i].startTime.slice(12, 14));
            durationM += Number(tableRow[i].startTime.slice(15, 17));
            return String(durationH).padStart(2, '0') + ":" + String(durationM).padStart(2, '0');
        }
    </script>
</body>

</html>